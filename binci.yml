from: serverless-react-stack
workDir: /app
services:
  - postgres:
      from: postgres:12.7 # Highest version supported by Aurora
      env:
        - POSTGRES_USER=postgres
        - POSTGRES_PASSWORD=postgres
        - POSTGRES_DB=postgress
      stopTimeSecs: 3 # Ensure shutdown
volumes:
  - /var/run/docker.sock:/var/run/docker.sock
expose:
  - 80:80
before: |
  export PGHOST=$POSTGRES_PORT_5432_TCP_ADDR
  export PGUSER=postgres
  export PGPASSWORD=postgres
  export PGDATABASE=postgres
  export PGPORT=5432
tasks:
  env: env | sort
  shell: /bin/sh
  dev: |
    node ./scripts/local.dev.js
    nginx -c /etc/nginx/nginx.conf
    sh ./tmp/startup.sh
